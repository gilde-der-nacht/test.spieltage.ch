import{g as a,c as i,t as d,i as g,S as X,a as $,b as B,s as $e,e as ge,d as ze,f as Ve,j as o,k as de,r as z,l as ee,h as V,M as K,n as ce,E as Ke,p as We}from"./web.DbXOegJ5.js";import{I as me,B as w,a as Ze,e as te,c as Je,S as fe,b as P}from"./utils.rHPz_DPg.js";import{e as qe,a as Z,o as E,n as W,s as h,b as O,c as Qe,l as Se,u as be,d as Re}from"./index.DNhYcyE5.js";import{c as Xe}from"./store.B4cJPa_y.js";var et=d("<h2>Kontaktdaten"),tt=d("<div class=content><small>Deine persönlichen Daten werden ausschliesslich für die Luzerner Spieltage 2025 verwendet. Nach dem Event werden diese gelöscht."),re=d("<br>"),ae=d("<div style=margin-block:.5rem;>");function nt(e){let n;return[a(et),a(tt),a(re),i(me,{label:"Name",name:"name",get value(){return e.save.name},onValueUpdate:t=>e.updateSave("name",t)}),i(X,{get when(){return e.save.name.trim().length===0},get children(){var t=a(ae);return g(t,i(w,{type:"danger",children:"Dies ist ein Pflichtfeld."})),t}}),a(re),i(Ze,{label:"E-Mail",name:"email",type:"email",get value(){return e.save.email},onValueUpdate:t=>e.updateSave("email",t),ref(t){var r=n;typeof r=="function"?r(t):n=t}}),i(X,{get when(){return e.save.email.trim().length===0},get children(){var t=a(ae);return g(t,i(w,{type:"danger",children:"Dies ist ein Pflichtfeld."})),t}}),i(X,{get when(){return e.save.email.length>0&&n.validity.typeMismatch},get children(){var t=a(ae);return g(t,i(w,{type:"danger",children:"Die Eingabe scheint keine gültige E-Mail-Adresse zu sein."})),t}}),a(re),i(me,{label:"Handynummer",name:"tel",type:"tel",get value(){return e.save.telephone},required:!1,onValueUpdate:t=>e.updateSave("telephone",t)})]}const ye=qe(["SATURDAY","SUNDAY"]);Z(E({uuid:h(),description:W(h()),title:W(h()),master_name:h(),playercount:E({min:O(),max:O()}),slot:E({day:ye,start:O(),end:O()}),external_link:W(E({label:h(),link:h()}))}));const ke=E({game:h(),self:Se(!0),player_name:Qe()}),xe=E({game:h(),self:Se(!1),player_name:h()}),rt=be([ke.extend({uuid:h().uuid()}),xe.extend({uuid:h().uuid()})]),at=be([ke,xe]),it=E({registration_uuid:h().uuid(),name:h(),email:h(),telephone:h(),wishes_updates:Re(),games:Z(rt),last_saved:h()});E({registration_uuid:h().uuid(),name:h(),email:h(),telephone:h(),wishes_updates:Re(),games:Z(at),last_saved:h()});async function lt(e){const n=te("/lst25/load");n.searchParams.append("secret",e);const t=await fetch(n);if(!t.ok)return{kind:"FAILED"};const r=await t.json(),l=it.safeParse(r);return l.success?{kind:"SUCCESS",save:l.data}:(console.error(l.error),{kind:"FAILED"})}const st=E({uuid:h(),title:h(),description:W(h()),playercount:E({min:O(),max:O()}),master_name:h(),slot:E({day:ye,start:O(),end:O()}),external_link:W(E({label:h(),link:h()}))}),ut=E({uuid:h().uuid(),game_uuid:h().uuid()});async function dt(){const e=te("/lst25/program"),n=te("/lst25/reserved"),[t,r]=await Promise.all([fetch(e),fetch(n)]);if(!t.ok)return{kind:"FAILED"};if(!r.ok)return{kind:"FAILED"};const l=await t.json(),s=await r.json(),u=Z(st).safeParse(l);if(!u.success)return{kind:"FAILED"};const c=Z(ut).safeParse(s);return c.success?{kind:"SUCCESS",program:{gameList:u.data,reservedList:c.data}}:{kind:"FAILED"}}function Te(e,n){const r=n.gameList.filter(s=>s.slot.day===e).map(s=>{const u=s.uuid,c=n.reservedList.filter(m=>m.game_uuid===u);return{...s,reserved_uuids:c.map(m=>m.uuid)}});let l={};for(const s of r){const{start:u}=s.slot,c=l[u]??[];c.push(s),l[u]=c}return Object.entries(l)}var ot=d("<label class=input-checkbox><input type=checkbox><!$><!/>");function gt(e){return(()=>{var n=a(ot),t=n.firstChild,r=t.nextSibling,[l,s]=$(r.nextSibling);return t.addEventListener("change",u=>e.onValueUpdate(u.target.checked)),g(n,()=>e.label,l,s),B(()=>$e(t,"name",e.name)),B(()=>ge(t,"value",e.value)),B(()=>ge(t,"checked",e.checked)),n})()}var ct=d("<li><h1 class=event-title></h1><div class=event-details><div class=event-tags><strong>Zeit:</strong> <!$><!/> - <!$><!/> Uhr</div><div class=event-tags><strong>Spielleitung:</strong> <!$><!/></div><!$><!/><div class=event-tags><strong>Freie Plätze:</strong> <!$><!/></div><!$><!/></div><div class=event-description><!$><!/><!$><!/></div><!$><!/>"),mt=d("<div class=event-tags><strong>Link: </strong><a style=border:none; target=_blank>"),vt=d("<span>Es hat noch <strong><!$><!/> Plätze</strong> frei."),ht=d("<span>Es hat noch <strong><!$><!/> Platz</strong> frei."),_t=d("<div class=event-tags style=display:block;><em>(Du hast dich bereits für eine Spielrunde eingetragen, die diese Spielrunde zeitlich überschneidet.)"),$t=d('<div class="event-description content"><p><strong>Beschreibung:</strong><br><!$><!/>'),ft=d("<div><p><strong>Deine Reservationen</strong></p><ul>"),St=d("<li style=font-size:0.83rem;>"),bt=d("<s>"),ve=d('<span title="ungespeicherte Änderung"> *'),Rt=d('<a href=javascript:; style=border:none; title="Reservation löschen">'),yt=d("<ul role=list class=event-links><li><a class=event-link href=javascript:;>+ Platz für mich reservieren"),kt=d("<ul role=list class=event-links><li><a class=event-link href=javascript:;>+ Platz für Begleitung reservieren"),xt=d("<h3 style=margin-block:1rem;>Start <!$><!/> Uhr"),Tt=d("<ul class=event-list role=list>"),Ct=d(`<style>
          .event-filters .active {
            color: var(--clr-success-10) !important;
          }
        `),Et=d("<div class=content><small>Auf dieser Seite kannst du dich und deine Freunde für Spielrunden einschreiben, solange es freie Plätze hat."),he=d("<br>"),Nt=d("<div class=event-filters><h2>Filter</h2><ul role=list><li><a href=javascript:;>Alle</a></li><!$><!/>"),At=d("<li><a href=javascript:;><!$><!/> Uhr"),Dt=d("<em>Keine Spielrunden gefunden.");const wt=0;function Q(e,n){const{from:t,to:r}=n;return t<=e&&e<=r}function Ft(e,n){const{from:t,to:r}=e,{from:l,to:s}=n;return Q(t,n)||Q(r,n)||Q(l,e)||Q(s,e)}function Ut(e){function n(){return[...e.confirmedReservations.map(l=>({name:l.player_name??e.selfName,confirmed:!0,game_uuid:e.entry.uuid,reservation_uuid:l.uuid,markedForDeletion:e.markedForDeletionReservations.includes(l.uuid)})),...e.tentativeReservations.map(l=>({name:l.friends_name??e.selfName,confirmed:!1,game_uuid:e.entry.uuid,markedForDeletion:!1}))]}function t(){const l=e.confirmedReservations.map(u=>u.uuid),s=e.entry.reserved_uuids.filter(u=>!l.includes(u));return e.entry.playercount.max-wt-s.length-n().filter(u=>!u.markedForDeletion).length}function r(){const{start:l,end:s}=e.entry.slot;return e.reservedTimeRanges.filter(c=>Ft({from:l,to:s},c.range)).filter(c=>c.game_uuid!==e.entry.uuid).length===0}return(()=>{var l=a(ct),s=l.firstChild,u=s.nextSibling,c=u.firstChild,m=c.firstChild,v=m.nextSibling,f=v.nextSibling,[_,R]=$(f.nextSibling),b=_.nextSibling,k=b.nextSibling,[A,F]=$(k.nextSibling);A.nextSibling;var N=c.nextSibling,M=N.firstChild,I=M.nextSibling,U=I.nextSibling,[Y,H]=$(U.nextSibling),j=N.nextSibling,[J,Ne]=$(j.nextSibling),ne=J.nextSibling,Ae=ne.firstChild,De=Ae.nextSibling,we=De.nextSibling,[Fe,Ue]=$(we.nextSibling),pe=ne.nextSibling,[Oe,Ie]=$(pe.nextSibling),q=u.nextSibling,Ge=q.firstChild,[oe,Pe]=$(Ge.nextSibling),Be=oe.nextSibling,[Me,He]=$(Be.nextSibling),Le=q.nextSibling,[Ye,je]=$(Le.nextSibling);return g(s,()=>e.entry.title),g(c,()=>e.entry.slot.start,_,R),g(c,()=>e.entry.slot.end,A,F),g(N,()=>e.entry.master_name,Y,H),g(u,(()=>{var C=o(()=>e.entry.external_link===null);return()=>C()?null:(()=>{var S=a(mt),T=S.firstChild,y=T.nextSibling;return g(y,()=>e.entry.external_link?.label),B(()=>$e(y,"href",e.entry.external_link?.link)),S})()})(),J,Ne),g(ne,(()=>{var C=o(()=>t()>1);return()=>C()?(()=>{var S=a(vt),T=S.firstChild,y=T.nextSibling,x=y.firstChild,[D,G]=$(x.nextSibling);return D.nextSibling,g(y,t,D,G),S})():o(()=>t()===1)()?(()=>{var S=a(ht),T=S.firstChild,y=T.nextSibling,x=y.firstChild,[D,G]=$(x.nextSibling);return D.nextSibling,g(y,t,D,G),S})():"Diese Spielrunde ist bereits voll besetzt."})(),Fe,Ue),g(u,(()=>{var C=o(()=>t()>0&&!r());return()=>C()?a(_t):null})(),Oe,Ie),g(q,(()=>{var C=o(()=>e.entry.description!==null&&e.entry.description.trim().length>0);return()=>C()?(()=>{var S=a($t),T=S.firstChild,y=T.firstChild,x=y.nextSibling,D=x.nextSibling,[G,p]=$(D.nextSibling);return g(T,()=>e.entry.description,G,p),S})():null})(),oe,Pe),g(q,(()=>{var C=o(()=>n().length>0);return()=>C()?(()=>{var S=a(ft),T=S.firstChild,y=T.nextSibling;return g(y,()=>n().map(x=>(()=>{var D=a(St);return g(D,(()=>{var G=o(()=>!!x.markedForDeletion);return()=>G()?[(()=>{var p=a(bt);return g(p,()=>x.name),p})(),a(ve)]:[o(()=>x.name),o(()=>o(()=>!!x.confirmed)()?null:a(ve)),(()=>{var p=a(Rt);return p.$$click=()=>e.deleteReservation(x),g(p,i(Je,{icon:"circle-max"})),z(),p})()]})()),D})())),S})():null})(),Me,He),g(l,(()=>{var C=o(()=>!!(t()>0&&r()));return()=>C()?o(()=>n().filter(S=>!S.markedForDeletion).length===0)()?(()=>{var S=a(yt),T=S.firstChild,y=T.firstChild;return y.$$click=()=>e.addTentativeReservation({game_uuid:e.entry.uuid,friends_name:null}),z(),S})():(()=>{var S=a(kt),T=S.firstChild,y=T.firstChild;return y.$$click=()=>{const x=prompt("Bitte teile uns mit, wie deine Begleitung heisst:");x!==null&&x.trim().length>0&&e.addTentativeReservation({game_uuid:e.entry.uuid,friends_name:x})},z(),S})():null})(),Ye,je),B(()=>de(l,`event-entry ${n().filter(C=>!C.markedForDeletion).length>0?"success":t()>0&&r()?"special":"gray"}`)),l})()}function pt(e){const n=e.confirmedReservations.filter(s=>!e.markedForDeletionReservations.includes(s.uuid)).map(s=>s.game);n.push(...e.tentativeReservations.map(s=>s.game_uuid));const t=new Set(n);return e.programByHour.flatMap(([s,u])=>u).filter(s=>t.has(s.uuid)).map(s=>({range:{from:s.slot.start,to:s.slot.end},game_uuid:s.uuid}))}function Ot(e){const n={MORNING:[],AFTERNOON:[],EVENING:[]};return e.forEach(t=>{const r=Number(t[0]);r<13?n.MORNING.push(t):r<18?n.AFTERNOON.push(t):n.EVENING.push(t)}),n}function Ce(e){const[n,t]=Ve([]);function r(v){t(f=>f.includes(v)?f.filter(_=>_!==v):[...f,v])}const l=()=>pt({programByHour:e.programByHour,confirmedReservations:e.confirmedReservations,tentativeReservations:e.tentativeReservations,markedForDeletionReservations:e.markedForDeletionReservations}),{MORNING:s,AFTERNOON:u,EVENING:c}=Ot(e.programByHour);function m(v){return o(()=>v.program.filter(([f])=>n().includes(f)||n().length===0).map(([f,_])=>[(()=>{var R=a(xt),b=R.firstChild,k=b.nextSibling,[A,F]=$(k.nextSibling);return A.nextSibling,g(R,f,A,F),R})(),(()=>{var R=a(Tt);return g(R,()=>_.map(b=>i(Ut,{entry:b,get selfName(){return e.selfName},get confirmedReservations(){return e.confirmedReservations.filter(k=>k.game===b.uuid)},get tentativeReservations(){return e.tentativeReservations.filter(k=>k.game_uuid===b.uuid)},get markedForDeletionReservations(){return e.markedForDeletionReservations},get reservedTimeRanges(){return l()},get addTentativeReservation(){return e.addTentativeReservation},get deleteReservation(){return e.deleteReservation}}))),R})()]))}return[a(Ct),a(Et),a(he),i(gt,{get checked(){return e.wishes_updates},onValueUpdate:v=>e.updateSave("wishes_updates",v),label:"Ja, ich möchte gerne Updates erhalten, wenn neue Spielrunden aufgeschaltet werden.",name:"wantsUpdates",value:"true"}),a(he),(()=>{var v=a(Nt),f=v.firstChild,_=f.nextSibling,R=_.firstChild,b=R.firstChild,k=R.nextSibling,[A,F]=$(k.nextSibling);return b.$$click=()=>t([]),g(_,()=>e.programByHour.map(([N,M])=>(()=>{var I=a(At),U=I.firstChild,Y=U.firstChild,[H,j]=$(Y.nextSibling);return H.nextSibling,U.$$click=()=>r(N),g(U,N,H,j),B(()=>de(U,n().includes(N)?"active":"")),z(),I})()),A,F),B(()=>de(b,n().length===0?"active":"")),z(),v})(),o(()=>o(()=>s.length===0&&u.length===0&&c.length===0)()?a(Dt):null),i(m,{program:s}),[],i(m,{program:u}),o(()=>o(()=>c.length>0)()?[i(m,{program:c})," "]:null)]}ze(["click"]);function It(e){const n=Te("SATURDAY",e.program);return i(Ce,{get selfName(){return e.selfName},programByHour:n,get confirmedReservations(){return e.confirmedReservations},get tentativeReservations(){return e.tentativeReservations},get markedForDeletionReservations(){return e.markedForDeletionReservations},get wishes_updates(){return e.wantsEmailUpdates},get addTentativeReservation(){return e.addTentativeReservation},get updateSave(){return e.updateSave},get deleteReservation(){return e.deleteReservation}})}function Gt(e){const n=Te("SUNDAY",e.program);return i(Ce,{get selfName(){return e.selfName},programByHour:n,get confirmedReservations(){return e.confirmedReservations},get tentativeReservations(){return e.tentativeReservations},get markedForDeletionReservations(){return e.markedForDeletionReservations},get wishes_updates(){return e.wantsEmailUpdates},get addTentativeReservation(){return e.addTentativeReservation},get updateSave(){return e.updateSave},get deleteReservation(){return e.deleteReservation}})}var Pt=d("<p><strong><!$><!/> </strong>| <!$><!/>, <!$><!/> bis <!$><!/> Uhr"),Bt=d("<p>Reservation für <strong>"),Mt=d("<ul role=list style=display:grid;gap:.5rem;>"),Ht=d("<li>"),Lt=d("<h3>Kontaktdaten"),Yt=d("<ul><li><strong>Name:</strong> <!$><!/></li><li><strong>E-Mail:</strong> <!$><!/></li><li><strong>Handynummer:</strong> <!$><!/>"),_e=d("<br>"),jt=d("<h3>Deine Reservationen"),zt=d("<h3>Updates"),Vt=d("<p><em>"),Kt=d("<p><em>Noch keine Reservationen getätigt."),Wt=d("<h4>Unbestätigt"),Zt=d("<p>Bitte speichere deinen aktuellen Stand der Anmeldung, damit wir die folgenden Reservationen bestätigen können."),ie=d("<h5>Samstag, 22. März 2025"),le=d("<h5>Sonntag, 23. März 2025"),Jt=d("<h4>Reservationen, die du entfernen möchtest"),qt=d("<p>Bitte speichere deinen aktuellen Stand der Anmeldung, damit wir die folgenden Reservationen entfernen können."),Qt=d("<h4>Bestätigt"),Xt=d("<span style=color:var(--clr-success-10);>Ja, ich möchte gerne Updates erhalten, wenn neue Spielrunden aufgeschaltet werden."),en=d("<span style=color:var(--clr-danger-10);>Nein, ich möchte keine E-Mails über neue Spielrunden erhalten.");function tn(e){const{game:n}=e;return i(w,{get type(){return e.type??"gray"},get children(){return[(()=>{var t=a(Pt),r=t.firstChild,l=r.firstChild,[s,u]=$(l.nextSibling);s.nextSibling;var c=r.nextSibling,m=c.nextSibling,[v,f]=$(m.nextSibling),_=v.nextSibling,R=_.nextSibling,[b,k]=$(R.nextSibling),A=b.nextSibling,F=A.nextSibling,[N,M]=$(F.nextSibling);return N.nextSibling,g(r,()=>n.title,s,u),g(t,()=>n.slot.day==="SATURDAY"?"Samstag":"Sonntag",v,f),g(t,()=>n.slot.start,b,k),g(t,()=>n.slot.end,N,M),t})(),(()=>{var t=a(Bt),r=t.firstChild,l=r.nextSibling;return g(l,()=>e.players.join(", ")),t})()]}})}function se(e,n){const t=[],r=[];for(const l of e){const s=n.gameList.find(u=>u.uuid===l.game_uuid);s?.slot.day==="SATURDAY"&&t.push({reservation:l,game:s}),s?.slot.day==="SUNDAY"&&r.push({reservation:l,game:s})}return{SATURDAY:t.toSorted((l,s)=>l.game.slot.start<s.game.slot.start?-1:1),SUNDAY:r.toSorted((l,s)=>l.game.slot.start<s.game.slot.start?-1:1)}}function nn(e,n){const t=Object.groupBy(e,r=>r.game.uuid);return Object.values(t).map(r=>{const l=r?.[0];return r===void 0||l===void 0?null:{game:l.game,players:r.map(s=>s.reservation.friends_name??n)}}).filter(r=>r!==null)}function rn(e){const n={MORNING:[],AFTERNOON:[],EVENING:[]};return e.forEach(t=>{const r=t.game.slot.start;r<13?n.MORNING.push(t):r<18?n.AFTERNOON.push(t):n.EVENING.push(t)}),n}function L(e){const n=nn(e.entries,e.selfName),{MORNING:t,AFTERNOON:r,EVENING:l}=rn(n),s=e.entries[0]?.game.slot.day==="SATURDAY";function u(c){return(()=>{var m=a(Mt);return g(m,()=>c.entries.map(v=>(()=>{var f=a(Ht);return g(f,i(tn,{get game(){return v.game},get players(){return v.players},get type(){return e.type}})),f})())),m})()}return[o(()=>o(()=>t.length>0)()?i(u,{entries:t}):null),o(()=>o(()=>t.length>0||r.length>0)()?[]:null),o(()=>o(()=>r.length>0)()?i(u,{entries:r}):null),o(()=>o(()=>!!(s&&(r.length>0||l.length>0)))()?[]:null),o(()=>o(()=>l.length>0)()?i(u,{entries:l}):null)]}function an(e){const{con:n,del:t}=e.save.games.reduce((u,c)=>e.markedForDeletionReservations.includes(c.uuid)?{...u,del:[...u.del,c]}:{...u,con:[...u.con,c]},{con:[],del:[]}),r=se(n.map(u=>({game_uuid:u.game,friends_name:u.player_name})),e.program),l=se(t.map(u=>({game_uuid:u.game,friends_name:u.player_name})),e.program),s=se(e.tentativeReservations,e.program);return[a(Lt),(()=>{var u=a(Yt),c=u.firstChild,m=c.firstChild,v=m.nextSibling,f=v.nextSibling,[_,R]=$(f.nextSibling),b=c.nextSibling,k=b.firstChild,A=k.nextSibling,F=A.nextSibling,[N,M]=$(F.nextSibling),I=b.nextSibling,U=I.firstChild,Y=U.nextSibling,H=Y.nextSibling,[j,J]=$(H.nextSibling);return g(c,()=>e.save.name,_,R),g(b,()=>e.save.email,N,M),g(I,()=>e.save.telephone,j,J),u})(),a(_e),a(jt),o(()=>o(()=>e.save.games.length===0&&e.tentativeReservations.length===0)()?a(Kt):null),o(()=>o(()=>e.tentativeReservations.length>0)()?[a(Wt),a(Zt),o(()=>o(()=>s.SATURDAY.length>0)()?[a(ie),i(L,{get entries(){return s.SATURDAY},get selfName(){return e.save.name},type:"special"})]:null),o(()=>o(()=>s.SUNDAY.length>0)()?[a(le),i(L,{get entries(){return s.SUNDAY},get selfName(){return e.save.name},type:"special"})]:null)]:null),o(()=>o(()=>t.length>0)()?[a(Jt),a(qt),o(()=>o(()=>l.SATURDAY.length>0)()?[a(ie),i(L,{get entries(){return l.SATURDAY},get selfName(){return e.save.name},type:"danger"})]:null),o(()=>o(()=>l.SUNDAY.length>0)()?[a(le),i(L,{get entries(){return l.SUNDAY},get selfName(){return e.save.name},type:"danger"})]:null)]:null),o(()=>o(()=>n.length>0)()?[a(Qt),o(()=>o(()=>r.SATURDAY.length>0)()?[a(ie),i(L,{get entries(){return r.SATURDAY},get selfName(){return e.save.name},type:"success"})]:null),o(()=>o(()=>r.SUNDAY.length>0)()?[a(le),i(L,{get entries(){return r.SUNDAY},get selfName(){return e.save.name},type:"success"})]:null)]:null),a(_e),a(zt),(()=>{var u=a(Vt),c=u.firstChild;return g(c,(()=>{var m=o(()=>!!e.save.wishes_updates);return()=>m()?a(Xt):a(en)})()),u})()]}var ln=d("<ul role=list style=display:flex;flex-wrap:wrap;column-gap:1rem;row-gap:.5rem;><li></li><li></li><li></li><li>"),sn=d("<div style=display:flex;justify-content:space-between;><div></div><div>"),un=d("<div style=display:flex;flex-wrap:wrap;justify-content:space-between;align-items:center;gap:1rem;><div>Zuletzt gespeichert am <!$><!/></div><div style=display:flex;flex-wrap:wrap;gap:1rem;align-items:center;margin-left:auto;><p><em><small></small></em></p><!$><!/>"),dn=d('<div style="padding-block:2rem 1rem;position:sticky;bottom:0;background-image:linear-gradient(transparent, var(--clr-3) 25%);">'),on=d("<div style=padding-block:1rem;>"),gn=d("<h2>Programm Samstag"),cn=d("<h2>Programm Sonntag"),mn=d("<div class=content><h2>Zusammenfassung</h2><small>Hier hast du die komplette Übersicht über alle deine Eingaben. Du kannst jederzeit zurückkommen und deine Kontaktdaten und Reservationen anpassen.</small><!$><!/>");function vn(e){return(()=>{var n=a(ln),t=n.firstChild,r=t.nextSibling,l=r.nextSibling,s=l.nextSibling;return g(t,i(P,{label:"Kontaktdaten",get kind(){return e.activeTab==="Contact"?"special":"gray"},onClick:()=>e.changeTab("Contact")})),g(r,i(P,{label:"Programm Samstag",get kind(){return e.activeTab==="Saturday"?"special":"gray"},onClick:()=>e.changeTab("Saturday")})),g(l,i(P,{label:"Program Sonntag",get kind(){return e.activeTab==="Sunday"?"special":"gray"},onClick:()=>e.changeTab("Sunday")})),g(s,i(P,{label:"Zusammenfassung",get kind(){return e.activeTab==="Summary"?"special":"gray"},onClick:()=>e.changeTab("Summary")})),n})()}function hn(e){function n(){switch(e.activeTab){case"Saturday":e.changeTab("Contact");break;case"Sunday":e.changeTab("Saturday");break;case"Summary":e.changeTab("Sunday");break}}function t(){switch(e.activeTab){case"Contact":e.changeTab("Saturday");break;case"Saturday":e.changeTab("Sunday");break;case"Sunday":e.changeTab("Summary");break}}return(()=>{var r=a(sn),l=r.firstChild,s=l.nextSibling;return g(l,(()=>{var u=o(()=>e.activeTab!=="Contact");return()=>u()?i(P,{label:"<< Vorheriger Schritt",onClick:n}):null})()),g(s,(()=>{var u=o(()=>e.activeTab!=="Summary");return()=>u()?i(P,{label:"Nächster Schritt >>",onClick:t}):null})()),r})()}function _n(e){const n=new Intl.DateTimeFormat("de-CH",{timeStyle:"short",dateStyle:"long"});return i(fe,{get type(){return e.state==="HAS_CHANGES"?"success":"gray"},get children(){var t=a(un),r=t.firstChild,l=r.firstChild,s=l.nextSibling,[u,c]=$(s.nextSibling),m=r.nextSibling,v=m.firstChild,f=v.firstChild,_=f.firstChild,R=v.nextSibling,[b,k]=$(R.nextSibling);return g(r,()=>n.format(new Date(e.lastSaved)),u,c),g(_,()=>e.state==="NO_CHANGES"?"keine Änderungen entdeckt":e.state==="HAS_CHANGES"?"ungespeicherte Änderungen entdeckt":""),g(m,i(P,{get disabled(){return e.state!=="HAS_CHANGES"},get label(){return e.state==="NO_CHANGES"?"Gespeichert.":e.state==="SAVING"?"Wird gespeichert...":"Speichern"},get kind(){return e.state==="HAS_CHANGES"?"success":"gray"},get onClick(){return e.saveCurrentState}}),b,k),t}})}function $n(e){return[i(vn,{get activeTab(){return e.activeTab},get changeTab(){return e.changeTab}}),(()=>{var n=a(on);return g(n,i(fe,{get children(){return[o(()=>o(()=>e.activeTab==="Contact")()?i(nt,{get save(){return e.save},get updateSave(){return e.updateSave}}):o(()=>e.activeTab==="Saturday")()?[a(gn),i(ee,{get fallback(){return i(w,{children:"Programm wird geladen ..."})},get children(){return i(V,{get children(){return i(K,{get when(){return e.programResource()},children:t=>i(It,{get selfName(){return e.save.name},get program(){return t()},get wantsEmailUpdates(){return e.save.wishes_updates},get confirmedReservations(){return e.confirmedReservations},get tentativeReservations(){return e.tentativeReservations},get markedForDeletionReservations(){return e.markedForDeletionReservations},get addTentativeReservation(){return e.addTentativeReservation},get updateSave(){return e.updateSave},get deleteReservation(){return e.deleteReservation}})})}})}})]:o(()=>e.activeTab==="Sunday")()?[a(cn),i(ee,{get fallback(){return i(w,{children:"Programm wird geladen ..."})},get children(){return i(V,{get children(){return i(K,{get when(){return e.programResource()},children:t=>i(Gt,{get selfName(){return e.save.name},get program(){return t()},get wantsEmailUpdates(){return e.save.wishes_updates},get confirmedReservations(){return e.confirmedReservations},get tentativeReservations(){return e.tentativeReservations},get markedForDeletionReservations(){return e.markedForDeletionReservations},get addTentativeReservation(){return e.addTentativeReservation},get updateSave(){return e.updateSave},get deleteReservation(){return e.deleteReservation}})})}})}})]:(()=>{var t=a(mn),r=t.firstChild,l=r.nextSibling,s=l.nextSibling,[u,c]=$(s.nextSibling);return g(t,i(ee,{get fallback(){return i(w,{children:"Zusammenfassung wird geladen ..."})},get children(){return i(V,{get children(){return i(K,{get when(){return e.programResource()},children:m=>i(an,{get save(){return e.save},get tentativeReservations(){return e.tentativeReservations},get program(){return m()},get markedForDeletionReservations(){return e.markedForDeletionReservations}})})}})}}),u,c),t})()),(()=>{var t=a(dn);return g(t,i(_n,{get lastSaved(){return e.lastSaved},get saveCurrentState(){return e.saveCurrentState},get state(){return e.saveState}})),t})()]}})),n})(),i(hn,{get activeTab(){return e.activeTab},get changeTab(){return e.changeTab}})]}function fn(){const e=new URL(location.href),n=e.searchParams.get("secret"),t=e.searchParams.get("showCreateMessage")==="true";return{secret:n,showCreateMessage:t}}async function Ee(e){if(e.secret===null)throw Error("SECRET_ERROR");const n=await lt(e.secret);if(n.kind==="FAILED")throw Error("SECRET_ERROR");return{state:"IDLE",secret:e.secret,showCreateMessage:e.showCreateMessage,currentSave:n.save,activeTab:"Contact",lastSaved:n.save.last_saved,hasChanged:!1,tentativeReservations:[],markedForDeletionReservations:[]}}async function Sn(){const e=await dt();if(e.kind==="FAILED")throw Error("PROGRAM_ERROR");return e.program}function bn(e){const[n,t]=Xe(e);function r(m){t("activeTab",m),window.scrollTo({top:0})}function l(m,v){t("hasChanged",!0),t("currentSave",m,v)}async function s(){if(n.state!=="IDLE")throw Error("ASSERTION_ERROR");t("state","SAVING");const m=te("/lst25/save"),v={...n.currentSave,games:[...n.currentSave.games.filter(_=>!n.markedForDeletionReservations.includes(_.uuid)),...n.tentativeReservations.map(_=>_.friends_name===null?{game:_.game_uuid,self:!0,player_name:null}:{game:_.game_uuid,self:!1,player_name:_.friends_name})]};if((await fetch(m,{method:"post",body:JSON.stringify(v),headers:{"Content-Type":"application/json"}})).ok){const _=await Ee({secret:n.secret,showCreateMessage:!1});t({..._,activeTab:n.activeTab})}else throw Error("SAVE_ERROR")}function u(m){t("hasChanged",!0),t("tentativeReservations",v=>[...v,m])}function c(m){if(t("hasChanged",!0),m.confirmed)t("markedForDeletionReservations",v=>[...v,m.reservation_uuid]);else{const v=n.currentSave.name;t("tentativeReservations",f=>f.filter(_=>_.game_uuid!==m.game_uuid?!0:_.friends_name===m.name?!1:m.name!==v))}}return{state:n,actions:{changeTab:r,updateSave:l,saveCurrentState:s,addTentativeReservation:u,deleteReservation:c}}}var ue=d("<br>"),Rn=d("<p>Wir konnten leider keine Anmeldung finden. Wenn du bereits eine Anmeldung begonnen hast, solltest du den korrekten Link per E-Mail erhalten haben.<br><br> Falls du noch keine Anmeldung begonnen hast, kannst du <a href=/anmeldung>hier</a> deine persönliche Anmeldung beginnen. <br><br>Für generelle Fragen oder Probleme, schreibe uns doch bitte über unser <a href=/kontatk>Kontaktformular</a>."),yn=d("<p>Leider ist ein unerwarteter Fehler passiert. Versuche deine Anmeldung erneut zu laden. Wiederholt sich dieser Fehler, bitte kontaktiere uns sobald als möglich über das <a href=/kontakt>Kontaktformular</a>, da dies nicht passieren sollte."),kn=d("<p>Deine Anmeldung wird geladen...");function xn(e){const{state:n,actions:t}=bn(e.state);return We(()=>{const r=new URL(location.href);r.searchParams.has("showCreateMessage")&&(r.searchParams.delete("showCreateMessage"),history.replaceState({},"",r))}),[i(X,{get when(){return n.showCreateMessage},get children(){return[i(w,{type:"success",get children(){return["Deine Anmeldung wurde erfolgreich gestartet.",a(ue),a(ue),"Wir haben eine E-Mail an deine Adresse gesendet. In dieser E-Mail findest du einen persönlichen Link, um deine Anmeldung anzupassen."]}}),a(ue)]}}),i($n,{get activeTab(){return n.activeTab},get changeTab(){return t.changeTab},get save(){return n.currentSave},get updateSave(){return t.updateSave},get lastSaved(){return n.lastSaved},get saveCurrentState(){return t.saveCurrentState},get saveState(){return n.state==="SAVING"?"SAVING":n.hasChanged?"HAS_CHANGES":"NO_CHANGES"},get programResource(){return e.programResource},get confirmedReservations(){return n.currentSave.games},get tentativeReservations(){return n.tentativeReservations},get addTentativeReservation(){return t.addTentativeReservation},get deleteReservation(){return t.deleteReservation},get markedForDeletionReservations(){return n.markedForDeletionReservations}})]}function An(){const e=fn(),[n]=ce(()=>Ee(e)),[t]=ce(()=>Sn());return i(Ke,{fallback:r=>i(w,{type:"danger",get children(){return i(V,{get fallback(){return a(yn)},get children(){return i(K,{get when(){return r.message==="SECRET_ERROR"},get children(){return a(Rn)}})}})}}),get children(){return i(ee,{get fallback(){return i(w,{get children(){return a(kn)}})},get children(){return i(V,{get children(){return i(K,{get when(){return n()},children:r=>i(xn,{get state(){return r()},programResource:t})})}})}})}})}export{An as MeineAnmeldung};
