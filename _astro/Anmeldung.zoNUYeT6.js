import{g as $,a as s,i,c as n,S as d,t as _}from"./web.BGDrlDKA.js";import{I as M,B as c,a as O,b as V,e as G,u as H,o as E,s as q,l as w}from"./utils.e6z2UOng.js";import{c as J}from"./store.XlVLhlw3.js";import{E as D}from"./ExitSpa.B46xHIx7.js";var K=_("<a href=/chat>Chat"),W=_("<form novalidate><!$><!/><!$><!/><!$><!/><!$><!/><!$><!/><!$><!/><!$><!/><!$><!/>"),Q=_("<div style=margin-block-start:1rem>");function re(){const[e,t]=J({form:{name:"",email:"",mobile:""},showErrors:{nameMissing:!1,emailMissing:!1,emailInvalid:!1,emailDuplicate:!1,general:!1},state:"IDLE"});let u;async function L(r){r.preventDefault();const f=e.form.name.trim().length===0;t("showErrors","nameMissing",f);const h=e.form.email.trim().length===0;t("showErrors","emailMissing",h);const p=u.validity.typeMismatch;if(t("showErrors","emailInvalid",p),!(e.showErrors.nameMissing||e.showErrors.emailMissing||e.showErrors.emailInvalid)){t("state","LOADING");try{const m={name:e.form.name,email:e.form.email,mobile:e.form.mobile},g=await fetch(G("/lst26/start"),{method:"post",body:JSON.stringify(m),headers:{"Content-Type":"application/json"}});if(!g.ok)t("showErrors","general",!0);else{const b=await g.json(),l=H([E({kind:w("SUCCESS"),data:E({secret:q()})}),E({kind:w("FAILURE"),reason:w("DUPLICATE_EMAIL")})]).parse(b);if(t("showErrors","emailDuplicate",l.kind==="FAILURE"&&l.reason==="DUPLICATE_EMAIL"),l.kind==="SUCCESS"){const o=new URL(location.origin+"/meine-anmeldung");o.searchParams.append("secret",l.data.secret),o.searchParams.append("showCreateMessage","true"),window.location.href=`${o.origin}${o.pathname}#/${o.search}`}}}catch(m){console.error(m),t("showErrors","general",!0)}finally{t("state","IDLE")}}}return[(()=>{var r=$(W),f=r.firstChild,[h,p]=s(f.nextSibling),m=h.nextSibling,[g,b]=s(m.nextSibling),S=g.nextSibling,[l,o]=s(S.nextSibling),A=l.nextSibling,[y,C]=s(A.nextSibling),U=y.nextSibling,[I,P]=s(U.nextSibling),T=I.nextSibling,[k,N]=s(T.nextSibling),B=k.nextSibling,[v,j]=s(B.nextSibling),R=v.nextSibling,[z,F]=s(R.nextSibling);return r.addEventListener("submit",L),i(r,n(M,{label:"Name",name:"name",get value(){return e.form.name},onValueUpdate:a=>{t("form","name",a),t("showErrors","nameMissing",!1)}}),h,p),i(r,n(d,{get when(){return e.showErrors.nameMissing},get children(){return n(c,{type:"danger",children:"Dies ist ein Pflichtfeld."})}}),g,b),i(r,n(O,{label:"E-Mail",name:"email",type:"email",get value(){return e.form.email},onValueUpdate:a=>{t("form","email",a),t("showErrors","emailMissing",!1),t("showErrors","emailInvalid",!1)},ref(a){var x=u;typeof x=="function"?x(a):u=a}}),l,o),i(r,n(d,{get when(){return e.showErrors.emailMissing},get children(){return n(c,{type:"danger",children:"Dies ist ein Pflichtfeld."})}}),y,C),i(r,n(d,{get when(){return e.showErrors.emailInvalid},get children(){return n(c,{type:"danger",children:"Die Eingabe scheint keine gültige E-Mail-Adresse zu sein."})}}),I,P),i(r,n(d,{get when(){return e.showErrors.emailDuplicate},get children(){return n(c,{type:"danger",get children(){return["Diese E-Mail wird bereits verwendet. Du solltest einen persönlichen Link erhalten haben, um deine fortzusetzen. Benötigst du Hilfe, dann kontaktiere uns bitte über das"," ",n(D,{href:"/kontakt",children:"Kontaktformular"})," oder unseren"," ",$(K),"."]}})}}),k,N),i(r,n(M,{label:"Handynummer (optional)",name:"mobile",type:"tel",get value(){return e.form.mobile},required:!1,onValueUpdate:a=>t("form","mobile",a)}),v,j),i(r,n(V,{type:"submit",get kind(){return e.state==="IDLE"?"success":"gray"},get label(){return e.state==="IDLE"?"Anmeldung starten":"Anmeldung wird gestartet"},get disabled(){return e.state==="LOADING"}}),z,F),r})(),n(d,{get when(){return e.showErrors.general},get children(){var r=$(Q);return i(r,n(c,{type:"danger",get children(){return["Es gab ein Problem, das wir nicht erwartet haben. Bitte versuche es erneut oder"," ",n(D,{href:"/kontakt",children:"kontaktiere uns direkt"}),"."]}})),r}})]}export{re as Anmeldung};
