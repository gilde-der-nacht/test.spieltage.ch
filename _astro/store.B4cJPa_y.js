import{$,y as q,z as F,A as T,f as C}from"./web.DbXOegJ5.js";const z=Symbol("store-raw"),P=Symbol("store-node"),b=Symbol("store-has"),I=Symbol("store-self");function L(n){let e=n[$];if(!e&&(Object.defineProperty(n,$,{value:e=new Proxy(n,X)}),!Array.isArray(n))){const o=Object.keys(n),l=Object.getOwnPropertyDescriptors(n);for(let i=0,f=o.length;i<f;i++){const r=o[i];l[r].get&&Object.defineProperty(n,r,{enumerable:l[r].enumerable,get:l[r].get.bind(e)})}}return e}function y(n){let e;return n!=null&&typeof n=="object"&&(n[$]||!(e=Object.getPrototypeOf(n))||e===Object.prototype||Array.isArray(n))}function g(n,e=new Set){let o,l,i,f;if(o=n!=null&&n[z])return o;if(!y(n)||e.has(n))return n;if(Array.isArray(n)){Object.isFrozen(n)?n=n.slice(0):e.add(n);for(let r=0,d=n.length;r<d;r++)i=n[r],(l=g(i,e))!==i&&(n[r]=l)}else{Object.isFrozen(n)?n=Object.assign({},n):e.add(n);const r=Object.keys(n),d=Object.getOwnPropertyDescriptors(n);for(let u=0,c=r.length;u<c;u++)f=r[u],!d[f].get&&(i=n[f],(l=g(i,e))!==i&&(n[f]=l))}return n}function N(n,e){let o=n[e];return o||Object.defineProperty(n,e,{value:o=Object.create(null)}),o}function K(n,e,o){if(n[e])return n[e];const[l,i]=C(o,{equals:!1,internal:!0});return l.$=i,n[e]=l}function H(n,e){const o=Reflect.getOwnPropertyDescriptor(n,e);return!o||o.get||!o.configurable||e===$||e===P||(delete o.value,delete o.writable,o.get=()=>n[$][e]),o}function M(n){T()&&K(N(n,P),I)()}function V(n){return M(n),Reflect.ownKeys(n)}const X={get(n,e,o){if(e===z)return n;if(e===$)return o;if(e===F)return M(n),o;const l=N(n,P),i=l[e];let f=i?i():n[e];if(e===P||e===b||e==="__proto__")return f;if(!i){const r=Object.getOwnPropertyDescriptor(n,e);T()&&(typeof f!="function"||n.hasOwnProperty(e))&&!(r&&r.get)&&(f=K(l,e,f)())}return y(f)?L(f):f},has(n,e){return e===z||e===$||e===F||e===P||e===b||e==="__proto__"?!0:(T()&&K(N(n,b),e)(),e in n)},set(){return!0},deleteProperty(){return!0},ownKeys:V,getOwnPropertyDescriptor:H};function h(n,e,o,l=!1){if(!l&&n[e]===o)return;const i=n[e],f=n.length;o===void 0?(delete n[e],n[b]&&n[b][e]&&i!==void 0&&n[b][e].$()):(n[e]=o,n[b]&&n[b][e]&&i===void 0&&n[b][e].$());let r=N(n,P),d;if((d=K(r,e,i))&&d.$(()=>o),Array.isArray(n)&&n.length!==f){for(let u=n.length;u<f;u++)(d=r[u])&&d.$();(d=K(r,"length",f))&&d.$(n.length)}(d=r[I])&&d.$()}function W(n,e){const o=Object.keys(e);for(let l=0;l<o.length;l+=1){const i=o[l];h(n,i,e[i])}}function Y(n,e){if(typeof e=="function"&&(e=e(n)),e=g(e),Array.isArray(e)){if(n===e)return;let o=0,l=e.length;for(;o<l;o++){const i=e[o];n[o]!==i&&h(n,o,i)}h(n,"length",l)}else W(n,e)}function D(n,e,o=[]){let l,i=n;if(e.length>1){l=e.shift();const r=typeof l,d=Array.isArray(n);if(Array.isArray(l)){for(let u=0;u<l.length;u++)D(n,[l[u]].concat(e),o);return}else if(d&&r==="function"){for(let u=0;u<n.length;u++)l(n[u],u)&&D(n,[u].concat(e),o);return}else if(d&&r==="object"){const{from:u=0,to:c=n.length-1,by:s=1}=l;for(let t=u;t<=c;t+=s)D(n,[t].concat(e),o);return}else if(e.length>1){D(n[l],e,[l].concat(o));return}i=n[l],o=[l].concat(o)}let f=e[0];typeof f=="function"&&(f=f(i,o),f===i)||l===void 0&&f==null||(f=g(f),l===void 0||y(i)&&y(f)&&!Array.isArray(f)?W(i,f):h(n,l,f))}function G(...[n,e]){const o=g(n||{}),l=Array.isArray(o),i=L(o);function f(...r){q(()=>{l&&r.length===1?Y(o,r[0]):D(o,r)})}return[i,f]}const E=Symbol("store-root");function S(n,e,o,l,i){const f=e[o];if(n===f)return;const r=Array.isArray(n);if(o!==E&&(!y(n)||!y(f)||r!==Array.isArray(f)||i&&n[i]!==f[i])){h(e,o,n);return}if(r){if(n.length&&f.length&&(!l||i&&n[0]&&n[0][i]!=null)){let c,s,t,A,O,w,a,j;for(t=0,A=Math.min(f.length,n.length);t<A&&(f[t]===n[t]||i&&f[t]&&n[t]&&f[t][i]===n[t][i]);t++)S(n[t],f,t,l,i);const _=new Array(n.length),R=new Map;for(A=f.length-1,O=n.length-1;A>=t&&O>=t&&(f[A]===n[O]||i&&f[A]&&n[O]&&f[A][i]===n[O][i]);A--,O--)_[O]=f[A];if(t>O||t>A){for(s=t;s<=O;s++)h(f,s,n[s]);for(;s<n.length;s++)h(f,s,_[s]),S(n[s],f,s,l,i);f.length>n.length&&h(f,"length",n.length);return}for(a=new Array(O+1),s=O;s>=t;s--)w=n[s],j=i&&w?w[i]:w,c=R.get(j),a[s]=c===void 0?-1:c,R.set(j,s);for(c=t;c<=A;c++)w=f[c],j=i&&w?w[i]:w,s=R.get(j),s!==void 0&&s!==-1&&(_[s]=f[c],s=a[s],R.set(j,s));for(s=t;s<n.length;s++)s in _?(h(f,s,_[s]),S(n[s],f,s,l,i)):h(f,s,n[s])}else for(let c=0,s=n.length;c<s;c++)S(n[c],f,c,l,i);f.length>n.length&&h(f,"length",n.length);return}const d=Object.keys(n);for(let c=0,s=d.length;c<s;c++)S(n[d[c]],f,d[c],l,i);const u=Object.keys(f);for(let c=0,s=u.length;c<s;c++)n[u[c]]===void 0&&h(f,u[c],void 0)}function J(n,e={}){const{merge:o,key:l="id"}=e,i=g(n);return f=>{if(!y(f)||!y(i))return i;const r=S(i,{[E]:f},E,o,l);return r===void 0?f:r}}export{G as c,J as r};
